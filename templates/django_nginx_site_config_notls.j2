{# This template is for no-encryption case, to avoid too many ifdefs #}
# {{ansible_managed}}
server {
        listen {{django.http_listen_port|default(80)}};
        listen [::]:{{django.http_listen_port|default(80)}};

        # this root is normally not available, either the site location
	# is at root, or frontend server only forwards prefixed requests
        root /usr/share/nginx/html;

        # HTTP-Host:
        server_name {{django.virtualhost}};

	{% if 'increased_body_size' in django %}
        client_max_body_size 100m;
        {% endif %}

        # Django collectstatic is configured to gather everything here
        # Location can be configured to be in a subtree to make reverse
        # proxy configuration easier.
        location {{"/" ~ django.url_prefix|default("")}}/static/ {
                alias /home/{{django.user}}/static/;
        }

        # Media files uploaded by users
        location {{"/" ~ django.url_prefix|default("")}}/media/ {
                alias /home/{{django.user}}/media/;
        }

        location {{"/" ~Â django.url_prefix|default("")}}/ {
                include uwsgi_params;
		{% if django.contract_port is defined %}
                uwsgi_pass 127.0.0.1:{{django.contract_port}};
		{% elif django.contract_socket is defined %}
		uwsgi_pass unix://{{django.contract_socket}};
		{% endif %}
        }

        # Used for Let's Encrypt certificate (re-)issuance process
        location /.well-known/acme-challenge {
            alias /srv/letsencrypt/challenges;
        }
}
